<root main_tree_to_execute="prendrePaletAuSol">
    <!-- ////////// -->
    <BehaviorTree ID="BehaviorTree">
        <ReactiveFallback>
            <Inverter>
                <Condition ID="IsArretUrgence"/>
            </Inverter>
            <Condition ID="IsTirettePresente"/>
            <SequenceStar>
                <SubTree ID="initRobot"/>
                <ReactiveSequence>
                    <Action ID="AfficherLeScore"/>
                    <ReactiveFallback>
                        <SubTree ID="campJaune"/>
                        <SubTree ID="campViolet"/>
                    </ReactiveFallback>
                </ReactiveSequence>
            </SequenceStar>
        </ReactiveFallback>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="campJaune">
        <ReactiveSequence>
            <Inverter>
                <Condition ID="IsCampViolet"/>
            </Inverter>
            <Condition ID="MinuterieNonEcoulee"/>
            <SequenceStar>
                <Action y="2" ID="Aller" x="1" theta="0"/>
                <Action y="0" ID="Aller" x="0" theta="0"/>
                <Action y="0" ID="Aller" x="0" theta="0"/>
            </SequenceStar>
        </ReactiveSequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="campViolet">
        <ReactiveSequence>
            <Condition ID="IsCampViolet"/>
            <Condition ID="MinuterieNonEcoulee"/>
            <Action y="2" ID="Aller" x="2" theta="0"/>
        </ReactiveSequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="initRobot">
        <Sequence>
            <Action ID="InitialiserPosition"/>
            <Action score="50" ID="DefinirLeScore"/>
            <Action seconds="1398" ID="LancerLaMinuterie"/>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="prendrePaletAuSol">
        <ReactiveSequence>
            <Inverter>
                <Condition ID="IsRobotEnMouvement"/>
            </Inverter>
            <ReactiveFallback>
                <ReactiveSequence>
                    <Action angle_base="170" angle_pince="80" ID="Bras"/>
                    <Action angle_base="180" angle_pince="51" ID="Bras"/>
                    <Action angle_base="156" angle_pince="27" ID="Bras"/>
                    <Sequence>
                        <RetryUntilSuccesful num_attempts="10">
                            <Condition ID="IsVentouseDroite"/>
                        </RetryUntilSuccesful>
                        <Action left_valve="true" right_valve="true" ID="Pince" middle_valve="true"/>
                    </Sequence>
                    <Action angle_base="170" angle_pince="110" ID="Bras"/>
                    <Action angle_base="90" angle_pince="110" ID="Bras"/>
                </ReactiveSequence>
                <Action angle_base="170" angle_pince="110" ID="Bras"/>
                <Action angle_base="90" angle_pince="110" ID="Bras"/>
            </ReactiveFallback>
        </ReactiveSequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="prendrePaletReserve">
        <ReactiveSequence>
            <Inverter>
                <Condition ID="IsRobotEnMouvement"/>
            </Inverter>
            <Condition y="10" ID="checkPosition" x="10"/>
            <ReactiveFallback>
                <Inverter>
                    <Condition ID="IsCampViolet"/>
                </Inverter>
                <Action angle_base="0" angle_pince="0" ID="Bras"/>
                <Condition ID="IsVentouseGauche"/>
                <Action left_valve="true" right_valve="false" ID="Pince" middle_valve="false"/>
                <Action angle_base="0" angle_pince="0" ID="Bras"/>
            </ReactiveFallback>
            <ReactiveFallback>
                <Condition ID="IsCampViolet"/>
                <Action angle_base="0" angle_pince="0" ID="Bras"/>
                <Condition ID="IsVentouseDroite"/>
                <Action left_valve="true" right_valve="false" ID="Pince" middle_valve="false"/>
                <Action angle_base="0" angle_pince="0" ID="Bras"/>
            </ReactiveFallback>
        </ReactiveSequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="prendrePaletStockAvant">
        <ReactiveSequence>
            <Inverter>
                <Condition ID="IsRobotEnMouvement"/>
            </Inverter>
            <ReactiveFallback>
                <Action angle_base="36" angle_pince="130" ID="Bras"/>
                <Action angle_base="35" angle_pince="140" ID="Bras"/>
                <Action angle_base="35" angle_pince="170" ID="Bras"/>
                <Action angle_base="38" angle_pince="180" ID="Bras"/>
                <Action angle_base="32" angle_pince="180" ID="Bras"/>
                <Condition ID="IsVentouseCentre"/>
                <Action left_valve="false" right_valve="false" ID="Pince" middle_valve="true"/>
                <Action angle_base="40" angle_pince="140" ID="Bras"/>
                <Action angle_base="40" angle_pince="90" ID="Bras"/>
                <Action angle_base="70" angle_pince="110" ID="Bras"/>
            </ReactiveFallback>
        </ReactiveSequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="ramasserGoldenium">
        <ReactiveSequence>
            <Inverter>
                <Condition ID="IsRobotEnMouvement"/>
            </Inverter>
            <Condition y="10" ID="checkPosition" x="10"/>
            <ReactiveFallback>
                <Inverter>
                    <Condition ID="IsCampViolet"/>
                </Inverter>
                <Action angle_base="0" angle_pince="0" ID="Bras"/>
                <Condition ID="IsVentouseGauche"/>
                <Action left_valve="true" right_valve="false" ID="Pince" middle_valve="false"/>
                <Action angle_base="0" angle_pince="0" ID="Bras"/>
            </ReactiveFallback>
            <ReactiveFallback>
                <Condition ID="IsCampViolet"/>
                <Action angle_base="0" angle_pince="0" ID="Bras"/>
                <Condition ID="IsVentouseDroite"/>
                <Action left_valve="true" right_valve="false" ID="Pince" middle_valve="false"/>
                <Action angle_base="0" angle_pince="0" ID="Bras"/>
            </ReactiveFallback>
        </ReactiveSequence>
    </BehaviorTree>
    <!-- ////////// -->
    <TreeNodesModel>
        <Action ID="AfficherLeScore"/>
        <Action ID="AjouterAuScore">
            <input_port default="1" name="score">Valeur Ã  ajouter au score</input_port>
        </Action>
        <Action ID="Aller">
            <input_port default="0" name="theta">Angle du robot (en degree)</input_port>
            <input_port default="0" name="x">Position absolue en X (en metre)</input_port>
            <input_port default="0" name="y">Position absolue en Y (en metre)</input_port>
        </Action>
        <Action ID="Attendre">
            <input_port default="1000" name="ms">Temps en millisecondes</input_port>
        </Action>
        <Action ID="Bras">
            <input_port default="0" name="angle_base">Angle moteur au plus pres de la base</input_port>
            <input_port default="0" name="angle_pince">Angle moteur au plus pres de la pince</input_port>
        </Action>
        <Action ID="DefinirLeScore">
            <input_port default="0" name="score">Valeur du score</input_port>
        </Action>
        <Action ID="DefinirTempsMinuterie">
            <input_port default="1398" name="seconds">Temps de la minuterie en secondes</input_port>
        </Action>
        <Action ID="InitialiserPosition"/>
        <Condition ID="IsArretUrgence"/>
        <Condition ID="IsCampViolet"/>
        <Condition ID="IsPaletCentre"/>
        <Condition ID="IsPaletDroit"/>
        <Condition ID="IsPaletGauche"/>
        <Condition ID="IsRobotEnMouvement"/>
        <Condition ID="IsTirettePresente"/>
        <Condition ID="IsVentouseCentre"/>
        <Condition ID="IsVentouseDroite"/>
        <Condition ID="IsVentouseGauche"/>
        <Action ID="LancerLaMinuterie">
            <input_port name="seconds"/>
        </Action>
        <Condition ID="MinuterieNonEcoulee"/>
        <Action ID="Pince">
            <input_port default="false" name="left_valve"/>
            <input_port default="false" name="middle_valve"/>
            <input_port default="false" name="right_valve"/>
        </Action>
        <Condition ID="ScoreInferieurA">
            <input_port default="1" name="score">Score</input_port>
        </Condition>
        <Condition ID="ScoreSuperieurA">
            <input_port default="0" name="score">Score</input_port>
        </Condition>
        <SubTree ID="TestSensors"/>
        <Action ID="VitesseConstante">
            <input_port default="0" name="angular_z">Vitesse de rotation en rad/s</input_port>
            <input_port default="0" name="linear_x">Vitesse dans le sens avant/arriere en m/s</input_port>
            <input_port default="0" name="linear_y">Vitesse dans le sens droite/gauche en m/s</input_port>
        </Action>
        <SubTree ID="campJaune"/>
        <SubTree ID="campViolet"/>
        <Condition ID="checkPosition">
            <input_port name="x"/>
            <input_port name="y"/>
        </Condition>
        <SubTree ID="initRobot"/>
        <SubTree ID="prendrePaletAuSol"/>
        <SubTree ID="prendrePaletReserve"/>
        <SubTree ID="prendrePaletStockAvant"/>
        <SubTree ID="ramasserGoldenium"/>
    </TreeNodesModel>
    <!-- ////////// -->
</root>

